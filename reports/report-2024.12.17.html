<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>rbui log analysis report</title>
  <meta name="description" content="rbui log analysis report">
  <style type="text/css">
    html, body {
      background-color: black;
    }
    th {
      text-align: center;
      color: silver;
      font-style: bold;
      padding: 5px;
      cursor: pointer;
    }
    table {
      width: auto;
      border-collapse: collapse;
      margin: 1%;
      color: silver;
    }
    td {
      text-align: right;
      font-size: 1.1em;
      padding: 5px;
    }
    .report-table-body-cell-url {
      text-align: left;
      width: 20%;
    }
    .clipped {
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow:hidden !important;
      max-width: 700px;
      word-wrap: break-word;
      display:inline-block;
    }
    .url {
      cursor: pointer;
      color: #729FCF;
    }
    .alert {
      color: red;
    }
  </style>
</head>

<body>
  <table border="1" class="report-table">
  <thead>
    <tr class="report-table-header-row">
    </tr>
  </thead>
  <tbody class="report-table-body">
  </tbody>

  <script type="text/javascript" src="/src/app/static/js/jquery-3.7.1.js"></script>
  <script type="text/javascript" src="/src/app/static/js/jquery.tablesorter.js"></script>
    <script type="application/json" id="json-data">
    [{"url": "/api/v2/internal/html5/phantomjs/queue/?wait=1m", "count": 2767, "time_sum": 174306.352, "time_max": 9843.569, "count_perc": 0.106, "time_perc": 9.044, "time_avg": 62.995, "time_med": 60.073}, {"url": "/api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=5", "count": 1410, "time_sum": 94618.864, "time_max": 9853.373, "count_perc": 0.054, "time_perc": 4.909, "time_avg": 67.106, "time_med": 60.124}, {"url": "/api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=2", "count": 1409, "time_sum": 94537.857, "time_max": 9826.572, "count_perc": 0.054, "time_perc": 4.905, "time_avg": 67.096, "time_med": 60.125}, {"url": "/api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=3", "count": 1393, "time_sum": 93594.358, "time_max": 9853.242, "count_perc": 0.053, "time_perc": 4.856, "time_avg": 67.189, "time_med": 60.125}, {"url": "/api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=4", "count": 1392, "time_sum": 93448.983, "time_max": 9826.209, "count_perc": 0.053, "time_perc": 4.849, "time_avg": 67.133, "time_med": 60.124}, {"url": "/api/v2/internal/gpmd_plan_report/queue/?wait=1m&worker=1", "count": 1414, "time_sum": 85075.406, "time_max": 71.291, "count_perc": 0.054, "time_perc": 4.414, "time_avg": 60.166, "time_med": 60.123}, {"url": "/export/ivi/200010-impression.csv", "count": 1320, "time_sum": 21951.65, "time_max": 24.053, "count_perc": 0.051, "time_perc": 1.139, "time_avg": 16.63, "time_med": 16.483}, {"url": "/api/v2/group/7123018/banners", "count": 784, "time_sum": 10247.771, "time_max": 9811.46, "count_perc": 0.03, "time_perc": 0.532, "time_avg": 13.071, "time_med": 0.537}, {"url": "/api/v2/banner/26647998", "count": 252, "time_sum": 10097.195, "time_max": 9811.884, "count_perc": 0.01, "time_perc": 0.524, "time_avg": 40.068, "time_med": 1.107}, {"url": "/api/v2/banner/26619125", "count": 252, "time_sum": 10093.061, "time_max": 9811.885, "count_perc": 0.01, "time_perc": 0.524, "time_avg": 40.052, "time_med": 1.09}, {"url": "/api/v2/banner/26618742", "count": 252, "time_sum": 10089.699, "time_max": 9811.885, "count_perc": 0.01, "time_perc": 0.524, "time_avg": 40.038, "time_med": 1.05}, {"url": "/api/v2/banner/26598670", "count": 252, "time_sum": 10073.002, "time_max": 9811.885, "count_perc": 0.01, "time_perc": 0.523, "time_avg": 39.972, "time_med": 0.975}, {"url": "/campaigns/7854376/banners/?", "count": 699, "time_sum": 10068.972, "time_max": 119.987, "count_perc": 0.027, "time_perc": 0.522, "time_avg": 14.405, "time_med": 13.488}, {"url": "/api/v2/banner/24389816", "count": 252, "time_sum": 10059.692, "time_max": 9811.886, "count_perc": 0.01, "time_perc": 0.522, "time_avg": 39.919, "time_med": 0.887}, {"url": "/api/v2/banner/24359968", "count": 252, "time_sum": 10058.138, "time_max": 9811.887, "count_perc": 0.01, "time_perc": 0.522, "time_avg": 39.913, "time_med": 0.954}, {"url": "/api/v2/banner/26594175", "count": 252, "time_sum": 10057.724, "time_max": 9811.886, "count_perc": 0.01, "time_perc": 0.522, "time_avg": 39.912, "time_med": 0.919}, {"url": "/api/v2/banner/26588410", "count": 252, "time_sum": 10047.677, "time_max": 9811.886, "count_perc": 0.01, "time_perc": 0.521, "time_avg": 39.872, "time_med": 0.833}, {"url": "/api/v2/banner/26585041", "count": 252, "time_sum": 10045.223, "time_max": 9811.886, "count_perc": 0.01, "time_perc": 0.521, "time_avg": 39.862, "time_med": 0.908}, {"url": "/api/v2/banner/24337272", "count": 252, "time_sum": 10044.812, "time_max": 9811.887, "count_perc": 0.01, "time_perc": 0.521, "time_avg": 39.86, "time_med": 0.831}, {"url": "/campaigns/7854473/banners/?", "count": 699, "time_sum": 8008.609, "time_max": 25.643, "count_perc": 0.027, "time_perc": 0.416, "time_avg": 11.457, "time_med": 11.243}, {"url": "//api/1/banners/", "count": 48, "time_sum": 5433.568, "time_max": 250.059, "count_perc": 0.002, "time_perc": 0.282, "time_avg": 113.199, "time_med": 105.634}, {"url": "/api/v2/internal/slots", "count": 236, "time_sum": 5341.743, "time_max": 36.195, "count_perc": 0.009, "time_perc": 0.277, "time_avg": 22.635, "time_med": 23.655}, {"url": "/campaigns/", "count": 1292, "time_sum": 5256.358, "time_max": 685.529, "count_perc": 0.049, "time_perc": 0.273, "time_avg": 4.068, "time_med": 1.485}, {"url": "/api/v2/slot/2406/groups", "count": 47, "time_sum": 4834.106, "time_max": 128.52, "count_perc": 0.002, "time_perc": 0.251, "time_avg": 102.853, "time_med": 102.41}, {"url": "/campaigns/7876636/banners/?", "count": 699, "time_sum": 4696.93, "time_max": 119.979, "count_perc": 0.027, "time_perc": 0.244, "time_avg": 6.719, "time_med": 6.191}, {"url": "/api/1/photogenic_banners/post/", "count": 19764, "time_sum": 4689.335, "time_max": 24.869, "count_perc": 0.756, "time_perc": 0.243, "time_avg": 0.237, "time_med": 0.135}, {"url": "/campaigns/7854362/banners/?", "count": 700, "time_sum": 4476.217, "time_max": 26.287, "count_perc": 0.027, "time_perc": 0.232, "time_avg": 6.395, "time_med": 6.188}, {"url": "/campaigns/7876633/banners/?", "count": 699, "time_sum": 4088.215, "time_max": 119.976, "count_perc": 0.027, "time_perc": 0.212, "time_avg": 5.849, "time_med": 5.343}, {"url": "/campaigns/7854359/banners/?", "count": 700, "time_sum": 3920.087, "time_max": 22.854, "count_perc": 0.027, "time_perc": 0.203, "time_avg": 5.6, "time_med": 5.446}, {"url": "/api/1/banners/?campaign=1392872", "count": 56, "time_sum": 3786.887, "time_max": 81.628, "count_perc": 0.002, "time_perc": 0.196, "time_avg": 67.623, "time_med": 67.381}, {"url": "/api/1/banners/?campaign=1200302", "count": 56, "time_sum": 3777.55, "time_max": 82.477, "count_perc": 0.002, "time_perc": 0.196, "time_avg": 67.456, "time_med": 66.743}, {"url": "/campaigns/statistic/?date1=01-06-2017&date2=30-06-2017&date_type=day&do=1", "count": 576, "time_sum": 3592.436, "time_max": 17.822, "count_perc": 0.022, "time_perc": 0.186, "time_avg": 6.237, "time_med": 5.237}, {"url": "/campaigns/7854408/banners/?", "count": 699, "time_sum": 3305.016, "time_max": 119.966, "count_perc": 0.027, "time_perc": 0.171, "time_avg": 4.728, "time_med": 4.422}, {"url": "/campaigns/7854389/banners/?", "count": 699, "time_sum": 3168.186, "time_max": 119.964, "count_perc": 0.027, "time_perc": 0.164, "time_avg": 4.532, "time_med": 4.124}, {"url": "/api/v2/slot/2902/groups", "count": 189, "time_sum": 3074.743, "time_max": 23.775, "count_perc": 0.007, "time_perc": 0.16, "time_avg": 16.268, "time_med": 16.238}, {"url": "/campaigns/7854366/banners/?", "count": 699, "time_sum": 2790.323, "time_max": 9.113, "count_perc": 0.027, "time_perc": 0.145, "time_avg": 3.992, "time_med": 3.858}, {"url": "/slots/3938/", "count": 442, "time_sum": 2707.473, "time_max": 99.429, "count_perc": 0.017, "time_perc": 0.14, "time_avg": 6.126, "time_med": 5.815}, {"url": "/campaigns/7806980/banners/", "count": 1374, "time_sum": 2638.779, "time_max": 1004.924, "count_perc": 0.053, "time_perc": 0.137, "time_avg": 1.921, "time_med": 0.883}, {"url": "/campaigns/7854372/banners/?", "count": 699, "time_sum": 2584.754, "time_max": 7.036, "count_perc": 0.027, "time_perc": 0.134, "time_avg": 3.698, "time_med": 3.592}, {"url": "/upload_file/ajax/", "count": 4387, "time_sum": 2514.586, "time_max": 37.06, "count_perc": 0.168, "time_perc": 0.13, "time_avg": 0.573, "time_med": 0.095}]
</script>
  <script type="text/javascript">
  !function($) {
    var table = JSON.parse(document.getElementById("json-data").textContent);
    var reportDates;
    var columns = new Array();
    var lastRow = 150;
    var $table = $(".report-table-body");
    var $header = $(".report-table-header-row");
    var $selector = $(".report-date-selector");

    $(document).ready(function() {
      $(window).bind("scroll", bindScroll);
        var row = table[0];
        for (k in row) {
          columns.push(k);
        }
        columns = columns.sort();
        columns = columns.slice(columns.length -1, columns.length).concat(columns.slice(0, columns.length -1));
        drawColumns();
        drawRows(table.slice(0, lastRow));
        $(".report-table").tablesorter();
    });

    function drawColumns() {
      for (var i = 0; i < columns.length; i++) {
        var $th = $("<th></th>").text(columns[i])
                                .addClass("report-table-header-cell")
        $header.append($th);
      }
    }

    function drawRows(rows) {
      for (var i = 0; i < rows.length; i++) {
        var row = rows[i];
        var $row = $("<tr></tr>").addClass("report-table-body-row");
        for (var j = 0; j < columns.length; j++) {
          var columnName = columns[j];
          var $cell = $("<td></td>").addClass("report-table-body-cell");
          if (columnName == "url") {
            var url = "https://rb.mail.ru" + row[columnName];
            var $link = $("<a></a>").attr("href", url)
                                    .attr("title", url)
                                    .attr("target", "_blank")
                                    .addClass("clipped")
                                    .addClass("url")
                                    .text(row[columnName]);
            $cell.addClass("report-table-body-cell-url");
            $cell.append($link);
          }
          else {
            $cell.text(row[columnName]);
            if (columnName == "time_avg" && row[columnName] > 0.9) {
              $cell.addClass("alert");
            }
          }
          $row.append($cell);
        }
        $table.append($row);
      }
      $(".report-table").trigger("update");
    }

    function bindScroll() {
      if($(window).scrollTop() == $(document).height() - $(window).height()) {
        if (lastRow < 1000) {
          drawRows(table.slice(lastRow, lastRow + 50));
          lastRow += 50;
        }
      }
    }

  }(window.jQuery)
  </script>
</body>
</html>
